#!/bin/bash
file="packages.txt"
while read -r line; do
   product=$(echo $line | cut -f1 -d\  )
   version=$(echo $line | cut -f2 -d\  )
   result=$(curl -s https://repology.org/project/$product/cves?version=$version | tr " " //n)
   if  [[ "$result"  =~ "version-outdated" ]]; then
       while IFS= read -r line; do
          if [[ $line =~ "nvd" ]]; then
             CVEt=$(echo $line | cut -d\" -f2)
             CVE=$(echo $CVEt | cut -d\" -f1)
          fi
          if  [[ $line =~ "version-outdated" ]]; then
             if [[ $line =~ "Highlighting" ]]; then
                #ignore
                echo "."
             else
                outdatedt=$(echo $line | cut -d\" -f4,5)
                outdated=$(echo $outdatedt | cut -d\< -f1)
                printf "$product : $version : $CVE : $outdated\n"
             fi
          fi
       done <<< "$result"
   fi
done < $file
